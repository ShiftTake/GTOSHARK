<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baccarat Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050816;
            --bg-elevated: #0b1020;
            --panel: #111827;
            --accent: #6366f1;
            --accent-soft: #4f46e5;
            --accent-strong: #a855f7;
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
        }

        body {
            font-family: 'Inter', sans-serif;
            background:
                radial-gradient(circle at 0% 0%, #1d1b4c 0, #050816 45%, #020617 100%);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .shell-card {
            background: radial-gradient(circle at top, #111827 0, #020617 70%);
            border-radius: 1.5rem;
            border: 1px solid rgba(148, 163, 184, 0.4);
            box-shadow:
                0 24px 80px rgba(15, 23, 42, 0.95),
                0 0 0 1px rgba(15, 23, 42, 0.6);
        }

        .card-container {
            min-height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .card {
            width: 70px;
            height: 100px;
            background: linear-gradient(145deg, #0f172a, #020617);
            color: #e5e7eb;
            border-radius: 0.75rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 6px 5px;
            margin: 0 4px;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.8),
                0 0 0 1px rgba(148, 163, 184, 0.4);
            transform: scale(0);
            animation: deal 0.25s ease-out forwards;
        }

        .card.red {
            color: #f97373;
        }

        .card-suit-top,
        .card-suit-bottom {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        @keyframes deal {
            to {
                transform: scale(1);
            }
        }

        .bet-button {
            transition: transform 0.1s, box-shadow 0.15s, background 0.15s;
            border-radius: 999px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.7);
        }

        .bet-button:active {
            transform: scale(0.97);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.8);
        }

        .bet-button-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-strong));
        }

        .bet-button-primary:hover {
            background: linear-gradient(135deg, var(--accent-strong), var(--accent));
        }

        .pill-input {
            border-radius: 999px;
        }

        .metric-card {
            background: rgba(15, 23, 42, 0.85);
            border-radius: 1rem;
            border: 1px solid rgba(148, 163, 184, 0.4);
        }

        .section-label {
            letter-spacing: 0.22em;
        }
    </style>
</head>
<body>

    <div class="w-full max-w-5xl shell-card p-8 sm:p-10">
        <!-- Header -->
        <div class="flex flex-col gap-3 mb-8 text-center">
            <div class="text-xs sm:text-sm font-semibold text-indigo-400 section-label">
                GTO SHARK · BACCARAT MODULE
            </div>
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-slate-50 tracking-tight">
                Simulate Baccarat. <span class="text-indigo-400">Track Risk.</span>
            </h1>
            <p class="text-sm sm:text-base text-slate-400 max-w-2xl mx-auto">
                Deal realistic shoes, test betting lines on Player, Banker, or Tie, and monitor bankroll risk in a
                clean GTO Shark inspired interface.
            </p>
        </div>

        <!-- Scoreboard and Bankroll -->
        <div class="flex flex-col md:flex-row justify-between gap-4 items-center mb-8 px-5 py-4 bg-slate-900/70 border border-slate-700 rounded-2xl shadow-inner">
            <div class="flex flex-col items-start">
                <span class="text-xs uppercase tracking-widest text-slate-400">Bankroll</span>
                <span class="text-2xl font-bold text-slate-50">
                    <span id="bankroll">1000.00</span>
                </span>
            </div>
            <div class="flex flex-col items-start">
                <span class="text-xs uppercase tracking-widest text-slate-400">Current Bet</span>
                <span class="text-2xl font-bold text-indigo-300">
                    <span id="current-bet">10</span>
                </span>
            </div>
        </div>

        <!-- Game Area: Cards and Scores -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-8">
            <!-- Player Area -->
            <div class="bg-slate-900/80 border border-indigo-500/60 p-5 rounded-2xl text-center shadow-lg">
                <h2 class="text-xl sm:text-2xl font-bold mb-3 text-indigo-200 flex items-center justify-center gap-2">
                    PLAYER
                    <span id="player-score" class="text-3xl font-extrabold text-slate-100">0</span>
                </h2>
                <div id="player-cards" class="card-container">
                    <!-- Cards will be injected here -->
                </div>
            </div>

            <!-- Banker Area -->
            <div class="bg-slate-900/80 border border-pink-500/60 p-5 rounded-2xl text-center shadow-lg">
                <h2 class="text-xl sm:text-2xl font-bold mb-3 text-pink-200 flex items-center justify-center gap-2">
                    BANKER
                    <span id="banker-score" class="text-3xl font-extrabold text-slate-100">0</span>
                </h2>
                <div id="banker-cards" class="card-container">
                    <!-- Cards will be injected here -->
                </div>
            </div>
        </div>

        <!-- Result Message -->
        <div id="result-message"
             class="text-center text-2xl sm:text-3xl font-extrabold p-4 rounded-2xl mb-8 shadow-xl bg-slate-900/80 border border-slate-700 text-slate-200"
             style="min-height: 60px;">
            Place your bet to begin this round.
        </div>

        <!-- Betting Controls -->
        <div class="bg-slate-900/80 border border-slate-700 p-6 rounded-2xl shadow-inner mb-8">
            <div class="flex flex-col sm:flex-row gap-2 items-start sm:items-center justify-between mb-4">
                <h3 class="text-lg sm:text-xl font-bold text-slate-100 flex items-center gap-2">
                    Betting Console
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[0.65rem] font-semibold bg-indigo-500/10 text-indigo-300 border border-indigo-500/40">
                        Live Simulation
                    </span>
                </h3>
                <span class="text-xs text-slate-400">
                    Select an amount, then choose Player, Banker, or Tie to simulate the hand.
                </span>
            </div>

            <div class="flex flex-col sm:flex-row gap-3 mb-5">
                <input
                    type="number"
                    id="bet-amount"
                    value="10"
                    min="1"
                    class="flex-grow p-3 pill-input rounded-full text-base bg-slate-950/70 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-slate-100 placeholder:text-slate-500"
                    placeholder="Enter bet amount">
                <button
                    onclick="setBet(10)"
                    class="w-full sm:w-auto px-4 py-2 pill-input bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-100 text-sm font-semibold transition duration-150">
                    Quick 10
                </button>
                <button
                    onclick="setBet(50)"
                    class="w-full sm:w-auto px-4 py-2 pill-input bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-100 text-sm font-semibold transition duration-150">
                    Quick 50
                </button>
                <button
                    onclick="setBet(100)"
                    class="w-full sm:w-auto px-4 py-2 pill-input bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-100 text-sm font-semibold transition duration-150">
                    Quick 100
                </button>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <button
                    id="bet-player-btn"
                    onclick="placeBet('Player')"
                    class="bet-button bet-button-primary p-4 text-lg font-bold text-slate-50 disabled:opacity-40 disabled:cursor-not-allowed transition duration-150 flex items-center justify-center gap-2">
                    Bet Player<span class="text-xs font-medium text-indigo-100/80">(1 : 1)</span>
                </button>
                <button
                    id="bet-banker-btn"
                    onclick="placeBet('Banker')"
                    class="bet-button p-4 text-lg font-bold rounded-full bg-gradient-to-r from-rose-500 to-red-500 hover:from-rose-400 hover:to-red-400 text-slate-50 disabled:opacity-40 disabled:cursor-not-allowed transition duration-150 flex items-center justify-center gap-2">
                    Bet Banker<span class="text-xs font-medium text-rose-100/80">(0.95 : 1)</span>
                </button>
                <button
                    id="bet-tie-btn"
                    onclick="placeBet('Tie')"
                    class="bet-button p-4 text-lg font-bold rounded-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 text-slate-50 disabled:opacity-40 disabled:cursor-not-allowed transition duration-150 flex items-center justify-center gap-2">
                    Bet Tie<span class="text-xs font-medium text-emerald-100/80">(8 : 1)</span>
                </button>
            </div>
        </div>

        <!-- Accuracy/Risk Metric Display -->
        <div class="mt-4 p-6 bg-slate-900/90 rounded-2xl shadow-xl border border-indigo-500/40">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-5">
                <h3 class="text-lg sm:text-xl font-bold text-slate-100">
                    Risk Management Metrics
                </h3>
                <span class="text-[0.7rem] uppercase tracking-[0.22em] text-indigo-300">
                    Edge Profile · 8-Deck Shoe
                </span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="metric-card p-3">
                    <div class="text-xs text-slate-400 mb-1">Player Expected Value (EV)</div>
                    <div id="ev-player" class="text-lg font-mono text-rose-400">-1.24%</div>
                </div>
                <div class="metric-card p-3">
                    <div class="text-xs text-slate-400 mb-1">Banker Expected Value (EV)</div>
                    <div id="ev-banker" class="text-lg font-mono text-rose-400">-1.06%</div>
                </div>
                <div class="metric-card p-3">
                    <div class="text-xs text-slate-400 mb-1">Tie Expected Value (EV)</div>
                    <div id="ev-tie" class="text-lg font-mono text-rose-400">-14.36%</div>
                </div>
            </div>

            <p class="mt-4 text-xs sm:text-sm text-slate-400 text-center max-w-2xl mx-auto">
                <span class="font-semibold text-rose-400">Note:</span>
                Values reflect the long-run house edge per unit wagered. With all EVs negative, the strictly optimal risk-management choice is no bet.
            </p>

            <div class="mt-5 p-4 bg-indigo-500/10 rounded-2xl border border-indigo-500/60 text-center">
                <div class="text-sm sm:text-base font-semibold text-indigo-200">
                    Conservative Bet Guide (2% of bankroll)
                </div>
                <div id="conservative-bet" class="text-2xl sm:text-3xl font-extrabold text-slate-50 mt-1">
                    20.00
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Core Game State ---
        let bankroll = 1000;
        let betAmount = 10;
        let currentBetType = null;
        let gameActive = false;
        let deck = [];
        const SUITS = ['♥', '♦', '♣', '♠'];
        const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K'];

        // Expected Values (House Edge for 8-deck shoe) - Note: These are fixed.
        const EV = {
            'Player': -0.0124, // -1.24%
            'Banker': -0.0106, // -1.06% (after 5% commission)
            'Tie': -0.1436     // -14.36%
        };

        // --- Utility Functions ---

        /**
         * Creates a standard 8-deck shoe.
         */
        function createDeck() {
            deck = [];
            for (let i = 0; i < 8; i++) { // 8 decks
                for (const suit of SUITS) {
                    for (const rank of RANKS) {
                        deck.push({ rank, suit });
                    }
                }
            }
            shuffleDeck();
        }

        /**
         * Shuffles the deck using the Fisher-Yates algorithm.
         */
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        /**
         * Deals the top card from the deck.
         * @returns {Object} The card object.
         */
        function dealCard() {
            if (deck.length < 10) { // Reshuffle if fewer than 10 cards remain
                createDeck();
            }
            return deck.pop();
        }

        /**
         * Gets the Baccarat value of a card.
         * @param {Object} card - The card object.
         * @returns {number} The Baccarat value (0-9).
         */
        function getCardValue(card) {
            const rank = card.rank;
            if (['T', 'J', 'Q', 'K'].includes(rank)) return 0;
            if (rank === 'A') return 1;
            return parseInt(rank);
        }

        /**
         * Calculates the Baccarat score for a hand.
         * @param {Array<Object>} hand - Array of card objects.
         * @returns {number} The Baccarat score (0-9).
         */
        function getScore(hand) {
            const sum = hand.reduce((acc, card) => acc + getCardValue(card), 0);
            return sum % 10;
        }

        /**
         * Determines if the Player should draw a third card based on Baccarat rules.
         * @param {number} score - Player's current score.
         * @returns {boolean} True if Player draws, False otherwise.
         */
        function playerDraws(score) {
            return score <= 5;
        }

        /**
         * Determines if the Banker should draw a third card based on Baccarat rules.
         * @param {number} bankerScore - Banker's current score.
         * @param {Object|null} playerThirdCard - The Player's third card, or null if none.
         * @returns {boolean} True if Banker draws, False otherwise.
         */
        function bankerDraws(bankerScore, playerThirdCard) {
            if (bankerScore >= 7) return false;
            if (bankerScore <= 2) return true;

            const playerThirdCardValue = playerThirdCard ? getCardValue(playerThirdCard) : -1;

            if (bankerScore === 3) return playerThirdCardValue !== 8;
            if (bankerScore === 4) return [2, 3, 4, 5, 6, 7].includes(playerThirdCardValue);
            if (bankerScore === 5) return [4, 5, 6, 7].includes(playerThirdCardValue);
            if (bankerScore === 6) return [6, 7].includes(playerThirdCardValue);

            return false; // Should not be reached
        }

        // --- UI Rendering Functions ---

        /**
         * Renders the card display HTML.
         * @param {Object} card - The card object.
         * @param {number} index - The index for animation delay.
         * @returns {string} HTML string for the card.
         */
        function renderCard(card, index) {
            const isRed = ['♥', '♦'].includes(card.suit);
            const colorClass = isRed ? 'red' : 'black';
            const delay = index * 0.08;

            return `
                <div class="card ${colorClass}" style="animation-delay: ${delay}s;">
                    <span class="card-suit-top">${card.suit}</span>
                    <span class="text-2xl">${card.rank}</span>
                    <span class="card-suit-bottom">${card.suit}</span>
                </div>
            `;
        }

        /**
         * Updates the main UI elements.
         */
        function updateUI() {
            document.getElementById('bankroll').textContent = bankroll.toFixed(2);
            document.getElementById('current-bet').textContent = betAmount;

            // Update conservative bet suggestion (2% of bankroll)
            const suggestedBet = bankroll * 0.02;
            document.getElementById('conservative-bet').textContent = suggestedBet.toFixed(2);

            // Control button state
            const buttons = document.querySelectorAll('.bet-button');
            buttons.forEach(btn => btn.disabled = gameActive || bankroll < betAmount);
            document.getElementById('bet-amount').disabled = gameActive;

            // Apply warning if bankroll is low
            if (bankroll < 50) {
                document.getElementById('bankroll').classList.add('text-rose-400');
            } else {
                document.getElementById('bankroll').classList.remove('text-rose-400');
            }
        }

        /**
         * Handles the final game result display and bankroll update.
         * @param {string} winner - 'Player', 'Banker', or 'Tie'.
         */
        function displayResult(winner) {
            let message = '';
            let color = '';
            let payout = 0;

            if (winner === 'Tie') {
                message = 'Tie. Bet returned.';
                color = 'bg-emerald-600/80 text-white';
                if (currentBetType === 'Tie') {
                    payout = betAmount * 8; // Tie payout 8:1
                    message = `Tie wins. Return ${payout.toFixed(2)}.`;
                    bankroll += payout;
                } else {
                    bankroll += betAmount; // Bet is returned on a tie
                }
            } else if (winner === currentBetType) {
                if (winner === 'Banker') {
                    payout = betAmount * 0.95; // Banker payout 0.95:1
                    message = `Banker wins. Net gain ${payout.toFixed(2)} (5% commission).`;
                } else { // Player wins
                    payout = betAmount; // Player payout 1:1
                    message = `Player wins. Net gain ${payout.toFixed(2)}.`;
                }
                bankroll += betAmount + payout; // return bet + winnings
                color = 'bg-indigo-600 text-white';
            } else {
                message = `${winner} wins. Loss ${betAmount.toFixed(2)}.`;
                color = 'bg-rose-600 text-white';
            }

            document.getElementById('result-message').className =
                `text-center text-2xl sm:text-3xl font-extrabold p-4 rounded-2xl mb-8 shadow-xl ${color}`;
            document.getElementById('result-message').textContent = message;

            currentBetType = null;
            gameActive = false;
            updateUI();
        }

        // --- Game Flow Functions ---

        /**
         * Sets the bet amount input field.
         * @param {number} amount - The amount to set.
         */
        function setBet(amount) {
            document.getElementById('bet-amount').value = amount;
            betAmount = amount;
            updateUI();
        }

        /**
         * Initiates the bet and starts the game.
         * @param {string} betType - 'Player', 'Banker', or 'Tie'.
         */
        function placeBet(betType) {
            const inputAmount = parseFloat(document.getElementById('bet-amount').value);

            if (isNaN(inputAmount) || inputAmount <= 0) {
                showMessage('Enter a valid bet amount.', 'bg-amber-500');
                return;
            }
            if (inputAmount > bankroll) {
                showMessage('Insufficient bankroll for this bet.', 'bg-rose-600');
                return;
            }

            betAmount = inputAmount;
            currentBetType = betType;
            gameActive = true;
            bankroll -= betAmount;

            showMessage(`Betting ${betAmount.toFixed(2)} on ${betType}...`, 'bg-slate-800');
            updateUI();

            // Clear previous cards and reset scores
            document.getElementById('player-cards').innerHTML = '';
            document.getElementById('banker-cards').innerHTML = '';
            document.getElementById('player-score').textContent = '0';
            document.getElementById('banker-score').textContent = '0';
            document.getElementById('player-score').classList.remove('text-emerald-400');
            document.getElementById('banker-score').classList.remove('text-emerald-400');

            setTimeout(startGame, 800);
        }

        /**
         * Main game loop (dealing cards and checking rules).
         */
        async function startGame() {
            if (deck.length < 10) createDeck();

            // Initial hands: 2 cards each
            let playerHand = [dealCard(), dealCard()];
            let bankerHand = [dealCard(), dealCard()];

            // Animate the standard Baccarat deal order: P1, B1, P2, B2
            await new Promise(resolve => {
                const cardSequence = [
                    { hand: 'player', card: playerHand[0] },
                    { hand: 'banker', card: bankerHand[0] },
                    { hand: 'player', card: playerHand[1] },
                    { hand: 'banker', card: bankerHand[1] }
                ];

                let currentCardIndex = 0;

                const dealNextCard = () => {
                    if (currentCardIndex < cardSequence.length) {
                        const { hand, card } = cardSequence[currentCardIndex];
                        const containerId = `${hand}-cards`;
                        document.getElementById(containerId).innerHTML += renderCard(card, currentCardIndex);
                        currentCardIndex++;
                        setTimeout(dealNextCard, 350);
                    } else {
                        resolve();
                    }
                };

                dealNextCard();
            });

            // Calculate initial scores
            let playerScore = getScore(playerHand);
            let bankerScore = getScore(bankerHand);

            // Update scores
            document.getElementById('player-score').textContent = playerScore;
            document.getElementById('banker-score').textContent = bankerScore;

            await new Promise(r => setTimeout(r, 800));

            // 2. Check for Naturals (8 or 9)
            if (playerScore >= 8 || bankerScore >= 8) {
                // Game ends (Natural)
                determineWinner(playerScore, bankerScore);
                return;
            }

            let playerThirdCard = null;
            let playerDrew = false;

            // 3. Player's Third Card Rule
            if (playerDraws(playerScore)) {
                playerThirdCard = dealCard();
                playerHand.push(playerThirdCard);
                playerDrew = true;

                // Render Player's 3rd card
                document.getElementById('player-cards').innerHTML += renderCard(playerThirdCard, playerHand.length - 1);
                playerScore = getScore(playerHand); // Recalculate score
                document.getElementById('player-score').textContent = playerScore;

                await new Promise(r => setTimeout(r, 500));
            }

            // 4. Banker's Third Card Rule
            if (bankerDraws(bankerScore, playerThirdCard)) {
                const bankerThirdCard = dealCard();
                bankerHand.push(bankerThirdCard);

                // Render Banker's 3rd card
                document.getElementById('banker-cards').innerHTML += renderCard(bankerThirdCard, bankerHand.length - 1);
                bankerScore = getScore(bankerHand); // Recalculate score
                document.getElementById('banker-score').textContent = bankerScore;

                await new Promise(r => setTimeout(r, 500));
            } else if (!playerDrew && bankerScore < 6) {
                // If Player didn't draw, Banker draws if score is 5 or less.
                if (bankerScore <= 5) {
                    const bankerThirdCard = dealCard();
                    bankerHand.push(bankerThirdCard);

                    // Render Banker's 3rd card
                    document.getElementById('banker-cards').innerHTML += renderCard(bankerThirdCard, bankerHand.length - 1);
                    bankerScore = getScore(bankerHand); // Recalculate score
                    document.getElementById('banker-score').textContent = bankerScore;

                    await new Promise(r => setTimeout(r, 500));
                }
            }

            // 5. Final Result
            determineWinner(playerScore, bankerScore);
        }

        /**
         * Determines the winner based on final scores and updates the display.
         * @param {number} playerScore - Final player score.
         * @param {number} bankerScore - Final banker score.
         */
        function determineWinner(playerScore, bankerScore) {
            let winner;
            if (playerScore > bankerScore) {
                winner = 'Player';
            } else if (bankerScore > playerScore) {
                winner = 'Banker';
            } else {
                winner = 'Tie';
            }

            // Highlight the winner's score
            if (winner === 'Player') {
                document.getElementById('player-score').classList.add('text-emerald-400');
            } else if (winner === 'Banker') {
                document.getElementById('banker-score').classList.add('text-emerald-400');
            }

            displayResult(winner);
        }

        /**
         * Utility to show a temporary message in the result box.
         * @param {string} text - The message to show.
         * @param {string} className - Tailwind background class.
         */
        function showMessage(text, className) {
            document.getElementById('result-message').className =
                `text-center text-2xl sm:text-3xl font-extrabold p-4 rounded-2xl mb-8 shadow-xl ${className}`;
            document.getElementById('result-message').textContent = text;
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            createDeck();
            updateUI();

            // Set up input change listener
            const betInput = document.getElementById('bet-amount');
            betInput.addEventListener('change', () => {
                let val = parseFloat(betInput.value);
                if (val <= 0 || isNaN(val)) {
                    val = 1;
                }
                betAmount = val;
                betInput.value = betAmount;
                updateUI();
            });

            // Display fixed EV metrics
            document.getElementById('ev-player').textContent = `${(EV.Player * 100).toFixed(2)}%`;
            document.getElementById('ev-banker').textContent = `${(EV.Banker * 100).toFixed(2)}%`;
            document.getElementById('ev-tie').textContent = `${(EV.Tie * 100).toFixed(2)}%`;
        });
    </script>
</body>
</html>

