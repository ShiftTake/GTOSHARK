<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blackjack Strategy Trainer – GTO Shark Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-outer: #020617; /* slate-950 */
      --bg-inner: #020617;
      --panel: rgba(15, 23, 42, 0.96);  /* slate-900 */
      --panel-soft: rgba(15, 23, 42, 0.9);
      --border-subtle: rgba(148, 163, 184, 0.35); /* slate-400 */
      --border-strong: rgba(129, 140, 248, 0.7);  /* indigo-400 */
      --text-main: #e5e7eb;   /* slate-200 */
      --text-soft: #9ca3af;   /* slate-400 */
      --accent-purple: #6366f1; /* indigo-500 */
      --accent-purple-soft: #818cf8; /* indigo-400 */
      --accent-blue: #3b82f6;  /* blue-500 */
      --accent-blue-soft: #60a5fa; /* blue-400 */
      --accent-green: #22c55e; /* green-500 */
      --accent-amber: #fbbf24; /* amber-400 */
      --accent-red: #f97373;   /* soft red for warnings */
    }

    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top, #111827 0%, var(--bg-outer) 55%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .casino-shell {
      background: radial-gradient(circle at top, #111827 0%, var(--bg-inner) 60%, #020617 100%);
      box-shadow:
        0 20px 60px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      border-radius: 2rem;
      border: 1px solid rgba(15, 23, 42, 0.9);
    }

    .casino-table {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.98));
      border-radius: 1.75rem;
      border: 1px solid var(--border-subtle);
      box-shadow:
        0 20px 60px rgba(15, 23, 42, 0.9),
        0 0 40px rgba(79, 70, 229, 0.28);
    }

    .stat-pill {
      background: radial-gradient(circle at top, rgba(148, 163, 184, 0.25), rgba(15, 23, 42, 0.9));
      border-radius: 1.25rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9), 0 8px 25px rgba(15, 23, 42, 0.9);
    }

    .panel {
      background: var(--panel);
      border-radius: 1.5rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.95);
    }

    .panel-soft {
      background: var(--panel-soft);
      border-radius: 1.5rem;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .chip-border {
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.9),
        0 0 0 2px rgba(148, 163, 184, 0.4),
        0 8px 18px rgba(15, 23, 42, 0.9);
    }

    .card-container {
      display: inline-flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      width: 56px;
      height: 82px;
      margin: 0 4px;
      padding: 5px;
      background: radial-gradient(circle at top, #f9fafb, #e5e7eb);
      border-radius: 0.75rem;
      box-shadow:
        0 8px 18px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(148, 163, 184, 0.65);
      font-size: 18px;
      font-weight: 900;
      color: #020617;
      text-align: center;
      transform: rotate(var(--rotation, 0deg));
    }

    .red-suit {
      color: #ef4444;
    }

    .black-suit {
      color: #111827;
    }

    .hole-card {
      background: radial-gradient(circle at top, #22c55e, #16a34a);
      border: 2px dashed rgba(241, 245, 249, 0.95);
      box-shadow:
        0 0 0 1px rgba(22, 163, 74, 0.9),
        0 0 30px rgba(22, 163, 74, 0.85);
      font-size: 1.6rem;
      color: #f9fafb;
    }

    .action-button {
      transition: transform 0.12s ease, box-shadow 0.18s ease, opacity 0.25s ease;
      border-radius: 9999px;
      box-shadow:
        0 10px 22px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(15, 23, 42, 0.9);
      letter-spacing: 0.04em;
    }

    .action-button:hover:not(:disabled) {
      transform: translateY(-1.5px);
      box-shadow:
        0 14px 28px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(129, 140, 248, 0.6);
    }

    .action-button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      box-shadow: 0 0 0 1px rgba(30, 64, 175, 0.5);
    }

    .free-bet-text {
      color: #bbf7d0;
      font-weight: bold;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      display: block;
      line-height: 1.1;
    }

    .soft-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }
  </style>
</head>
<body class="p-4 sm:p-8">

  <div class="casino-shell w-full max-w-md sm:max-w-lg p-3 sm:p-4">
    <div class="casino-table w-full p-4 sm:p-6 md:p-7">

      <!-- Top stats row -->
      <div class="mb-4 grid grid-cols-3 gap-2 sm:gap-3">
        <div class="stat-pill px-3 py-2 text-center">
          <div class="soft-label text-slate-400 mb-0.5">Hands</div>
          <div id="stats-total" class="text-xl sm:text-2xl font-black text-slate-50">0</div>
        </div>
        <div class="stat-pill px-3 py-2 text-center">
          <div class="soft-label text-slate-400 mb-0.5">Correct</div>
          <div id="stats-correct" class="text-xl sm:text-2xl font-black text-emerald-400">0</div>
        </div>
        <div class="stat-pill px-3 py-2 text-center">
          <div class="soft-label text-slate-400 mb-0.5">Accuracy</div>
          <div id="stats-accuracy" class="text-xl sm:text-2xl font-black text-amber-300">0%</div>
        </div>
      </div>

      <!-- Title + Free hands -->
      <div class="flex items-center justify-between gap-3 mb-4">
        <h1 class="text-lg sm:text-xl font-black tracking-tight text-slate-50">
          Blackjack Strategy GTO Trainer
          <span class="ml-1 text-[0.65rem] align-super font-bold text-amber-300 tracking-[0.18em]">FREE DEMO</span>
        </h1>

        <div class="chip-border rounded-full bg-slate-900/90 px-3 py-1 text-[0.7rem] text-slate-300 flex items-center gap-1.5">
          <span class="soft-label text-slate-400">Demo</span>
          <span class="text-xs text-slate-100">Hands Left:</span>
          <span id="free-left" class="text-xs font-extrabold text-emerald-400">3</span>
        </div>
      </div>

      <!-- Configuration Selector -->
      <div class="panel-soft px-4 py-3 sm:px-5 sm:py-4 mb-5">
        <p class="soft-label text-indigo-300 text-center mb-2">Select Game Rules</p>
        <div class="flex flex-col gap-2 items-stretch">
          <select id="game-version" class="w-full rounded-xl border border-slate-600 bg-slate-900/80 text-slate-100 text-sm px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-400">
            <option value="6DeckS17">Classic 6-Deck (S17)</option>
            <option value="SingleDeckH17">Single-Deck (H17)</option>
            <option value="DoubleDeckS17">Double-Deck (S17)</option>
            <option value="VegasStrip">Vegas Strip (4D S17)</option>
            <option value="AtlanticCity">Atlantic City (8D S17 + Surrender)</option>
            <option value="FreeBet">Free Bet Blackjack (22 Push)</option>
            <option value="Switch">Blackjack Switch (22 Push, BJ 1:1)</option>
            <option value="Spanish21">Spanish 21 (No 10s)</option>
          </select>
          <p class="text-[0.7rem] text-slate-400 text-center tracking-[0.18em] uppercase">
            Elite Unlimited
          </p>
        </div>
      </div>

      <!-- Dealer Hand -->
      <div class="panel px-4 py-4 sm:px-5 sm:py-5 mb-4">
        <h2 class="text-lg sm:text-xl font-extrabold mb-3 text-sky-200 text-center">
          Dealer Up Card (<span id="dealer-value">?</span>)
        </h2>
        <div id="dealer-hand" class="flex justify-center flex-wrap min-h-[90px]"></div>
      </div>

      <!-- Player Hand -->
      <div class="panel px-4 py-4 sm:px-5 sm:py-5 mb-4">
        <h2 class="text-lg sm:text-xl font-extrabold mb-3 text-slate-50 text-center">
          Your Hand (<span id="player-value">?</span>)
        </h2>
        <div id="player-hand" class="flex justify-center flex-wrap min-h-[90px]"></div>
      </div>

      <!-- Game Info and Feedback -->
      <div id="feedback" class="panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-slate-900/70 shadow-inner border border-slate-700/70">
        Select a version and tap <span class="font-bold text-emerald-300">New Hand</span> to start.
      </div>

      <!-- Action Buttons -->
      <div id="controls" class="flex flex-col gap-3 mb-6">
        <div class="flex flex-wrap justify-center gap-2.5">
          <button id="hit-btn"
                  class="action-button bg-indigo-500 hover:bg-indigo-400 text-slate-50 font-bold py-2.5 px-5 text-xs sm:text-sm"
                  disabled>
            HIT
          </button>
          <button id="stand-btn"
                  class="action-button bg-slate-600 hover:bg-slate-500 text-slate-50 font-bold py-2.5 px-5 text-xs sm:text-sm"
                  disabled>
            STAND
          </button>
          <button id="double-btn"
                  class="action-button bg-amber-500 hover:bg-amber-400 text-slate-900 font-bold py-2.5 px-5 text-xs sm:text-sm"
                  disabled>
            DOUBLE
          </button>
        </div>

        <div class="flex flex-wrap justify-center gap-2.5">
          <button id="split-btn"
                  class="action-button bg-slate-700 hover:bg-slate-600 text-slate-100 font-bold py-2.5 px-5 text-xs sm:text-sm"
                  disabled>
            SPLIT
          </button>
          <button id="surrender-btn"
                  class="action-button bg-rose-500 hover:bg-rose-400 text-slate-50 font-bold py-2.5 px-5 text-xs sm:text-sm hidden"
                  disabled>
            SURRENDER
          </button>
        </div>
      </div>

      <!-- Control Buttons -->
      <div class="flex flex-wrap justify-center gap-3 mb-1">
        <button id="repeat-hand-btn"
                class="action-button bg-amber-700/90 hover:bg-amber-600 text-slate-100 font-bold py-2.5 px-5 text-xs sm:text-sm"
                disabled>
          REPEAT HAND
        </button>
        <button id="restart-stats-btn"
                class="action-button bg-rose-600 hover:bg-rose-500 text-slate-50 font-bold py-2.5 px-5 text-xs sm:text-sm">
          RESTART STATS
        </button>
      </div>

      <div class="flex flex-wrap justify-center gap-3 mt-2">
        <button id="new-hand-btn"
                class="action-button bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-extrabold py-2.5 px-8 text-xs sm:text-sm">
          NEW HAND
        </button>
        <button id="restore-btn"
                class="action-button bg-slate-700 hover:bg-slate-600 text-slate-50 font-semibold py-2.5 px-6 text-xs sm:text-sm"
                disabled>
          RESTORE
        </button>
      </div>
    </div>
  </div>

  <!-- Upgrade Modal -->
  <div id="upgrade-overlay" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-40"></div>
  <div id="upgrade-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-slate-900 text-slate-100 rounded-2xl shadow-2xl border border-indigo-500/70 overflow-hidden">
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4">
        <h4 class="text-xl font-extrabold tracking-tight">Unlock Full Trainer</h4>
        <p class="text-xs sm:text-sm opacity-90 mt-1">You’ve used your 3 free demo hands.</p>
      </div>
      <div class="p-6 space-y-3 text-sm">
        <ul class="list-disc list-inside text-slate-200 space-y-1.5">
          <li>Unlimited randomized hands across all rule sets</li>
          <li>All variants including surrender, free bet, switch, and Spanish 21</li>
          <li>Detailed explanations and misplay review after each hand</li>
          <li>Long-term progress tracking and streak summaries</li>
        </ul>
        <div class="bg-slate-800/80 rounded-xl p-3 flex items-center justify-between">
          <div>
            <p class="text-xs uppercase tracking-[0.22em] text-indigo-300">Today Only</p>
            <p class="text-[0.7rem] text-slate-400">Founders-tier full access pricing</p>
          </div>
          <div class="text-right">
            <p class="text-emerald-400 font-black text-lg leading-none">29.99</p>
            <p class="text-[0.65rem] text-slate-400 tracking-[0.16em] uppercase mt-1">One-time unlock</p>
          </div>
        </div>
      </div>
      <div class="px-6 py-4 flex gap-3 justify-end bg-slate-900/90 border-t border-slate-700/70">
        <button id="modal-close" class="px-4 py-2 rounded-xl border border-slate-600 text-sm hover:bg-slate-800/80">
          Not now
        </button>
        <button id="modal-upgrade" class="px-5 py-2 rounded-xl bg-emerald-500 text-slate-900 font-bold text-sm hover:bg-emerald-400 shadow-md shadow-emerald-900/60">
          Upgrade
        </button>
      </div>
    </div>
  </div>

  <script>
    // ===== Core Game Data =====
    const RANKS=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    const SUITS=['♠','♥','♦','♣'];
    const VALUES={'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'10':10,'J':10,'Q':10,'K':10,'A':11};

    // ===== Strategies (same as your version; trimmed comments for brevity) =====
    const STANDARD_STRATEGY_S17={
      'P':{
        'AA':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'P','8':'P','9':'P','10':'P','A':'P'},
        '1010':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'S','8':'S','9':'S','10':'S','A':'S'},
        '99':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'S','8':'P','9':'P','10':'S','A':'S'},
        '88':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'P','8':'P','9':'P','10':'P','A':'P'},
        '77':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'P','8':'H','9':'H','10':'H','A':'H'},
        '66':{'2':'P','3':'P','4':'P','5':'P','6':'H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '55':{'2':'D/H','3':'D/H','4':'D/H','5':'D/H','6':'D/H','7':'D/H','8':'D/H','9':'D/H','10':'D/H','A':'D/H'},
        '44':{'2':'H','3':'H','4':'P','5':'P','6':'P','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '33':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '22':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'H','8':'H','9':'H','10':'H','A':'H'}
      },
      'S':{
        '20':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'S','8':'S','9':'S','10':'S','A':'S'},
        '19':{'2':'S','3':'S','4':'S','5':'S','6':'D/S','7':'S','8':'S','9':'S','10':'S','A':'S'},
        '18':{'2':'S','3':'D/S','4':'D/S','5':'D/S','6':'D/S','7':'S','8':'S','9':'H','10':'H','A':'H'},
        '17':{'2':'H','3':'D/H','4':'D/H','5':'D/H','6':'D/H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '16':{'2':'H','3':'H','4':'D/H','5':'D/H','6':'D/H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '15':{'2':'H','3':'H','4':'D/H','5':'D/H','6':'D/H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '14':{'2':'H','3':'H','4':'H','5':'D/H','6':'D/H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '13':{'2':'H','3':'H','4':'H','5':'H','6':'D/H','7':'H','8':'H','9':'H','10':'H','A':'H'}
      },
      'H':{
        '17':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'S','8':'S','9':'S','10':'S','A':'S'},
        '16':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '15':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '14':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '13':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '12':{'2':'H','3':'H','4':'S','5':'S','6':'S','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '11':{'2':'D/H','3':'D/H','4':'D/H','5':'D/H','6':'D/H','7':'D/H','8':'D/H','9':'D/H','10':'D/H','A':'D/H'},
        '10':{'2':'D/H','3':'D/H','4':'D/H','5':'D/H','6':'D/H','7':'D/H','8':'D/H','9':'D/H','10':'H','A':'H'},
        '9':{'2':'H','3':'D/H','4':'D/H','5':'D/H','6':'D/H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '8':{'2':'H','3':'H','4':'H','5':'H','6':'H','7':'H','8':'H','9':'H','10':'H','A':'H'}
      }
    };

    const STANDARD_STRATEGY_H17=JSON.parse(JSON.stringify(STANDARD_STRATEGY_S17));
    STANDARD_STRATEGY_H17.S['18']['A']='H';
    STANDARD_STRATEGY_H17.H['11']['A']='H';

    const AC_STRATEGY=JSON.parse(JSON.stringify(STANDARD_STRATEGY_S17));
    AC_STRATEGY.H['16']['10']='R/H';
    AC_STRATEGY.H['15']['10']='R/H';
    AC_STRATEGY.H['16']['A']='R/H';

    const FREE_BET_STRATEGY={
      'P':{
        'AA':{'2':'FP','3':'FP','4':'FP','5':'FP','6':'FP','7':'FP','8':'FP','9':'FP','10':'FP','A':'FP'},
        '1010':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'S','8':'S','9':'S','10':'S','A':'S'},
        '99':{'2':'FP','3':'FP','4':'FP','5':'FP','6':'FP','7':'S','8':'FP','9':'FP','10':'S','A':'S'},
        '88':{'2':'FP','3':'FP','4':'FP','5':'FP','6':'FP','7':'FP','8':'FP','9':'FP','10':'FP','A':'FP'},
        '77':{'2':'FP','3':'FP','4':'FP','5':'FP','6':'FP','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '66':{'2':'FP','3':'FP','4':'FP','5':'FP','6':'H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '55':STANDARD_STRATEGY_S17.H['10'],
        '44':{'2':'H','3':'H','4':'H','5':'H','6':'H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '33':{'2':'FP','3':'FP','4':'FP','5':'FP','6':'FP','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '22':{'2':'FP','3':'FP','4':'FP','5':'FP','6':'FP','7':'H','8':'H','9':'H','10':'H','A':'H'}
      },
      'S':STANDARD_STRATEGY_S17.S,
      'H':{
        '17':STANDARD_STRATEGY_S17.H['17'],
        '16':STANDARD_STRATEGY_S17.H['16'],
        '15':STANDARD_STRATEGY_S17.H['15'],
        '14':STANDARD_STRATEGY_S17.H['14'],
        '13':STANDARD_STRATEGY_S17.H['13'],
        '12':STANDARD_STRATEGY_S17.H['12'],
        '11':{'2':'FD/H','3':'FD/H','4':'FD/H','5':'FD/H','6':'FD/H','7':'FD/H','8':'FD/H','9':'FD/H','10':'FD/H','A':'H'},
        '10':{'2':'FD/H','3':'FD/H','4':'FD/H','5':'FD/H','6':'FD/H','7':'FD/H','8':'FD/H','9':'FD/H','10':'H','A':'H'},
        '9':{'2':'H','3':'FD/H','4':'FD/H','5':'FD/H','6':'FD/H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '8':STANDARD_STRATEGY_S17.H['8'],
      }
    };

    const SPANISH_21_STRATEGY={
      'P':{
        'AA':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'P','8':'P','9':'P','10':'P','A':'P'},
        '1010':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'S','8':'S','9':'S','10':'S','A':'S'},
        '99':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'S','8':'P','9':'P','10':'S','A':'S'},
        '88':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'P','8':'P','9':'P','10':'P','A':'P'},
        '77':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'P','8':'H','9':'H','10':'H','A':'H'},
        '66':{'2':'P','3':'P','4':'P','5':'P','6':'H','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '55':STANDARD_STRATEGY_H17.H['10'],
        '44':{'2':'H','3':'H','4':'P','5':'P','6':'P','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '33':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'H','8':'H','9':'H','10':'H','A':'H'},
        '22':{'2':'P','3':'P','4':'P','5':'P','6':'P','7':'H','8':'H','9':'H','10':'H','A':'H'}
      },
      'S':STANDARD_STRATEGY_H17.S,
      'H':{
        '17':Object.fromEntries(['2','3','4','5','6','7','8','9','10','A'].map(k=>[k,'D/H'])),
        '16':Object.fromEntries(['2','3','4','5','6','7','8','9','10','A'].map(k=>[k,'D/H'])),
        '15':Object.fromEntries(['2','3','4','5','6','7','8','9','10','A'].map(k=>[k,'D/H'])),
        '14':Object.fromEntries(['2','3','4','5','6','7','8','9','10','A'].map(k=>[k,'D/H'])),
        '13':Object.fromEntries(['2','3','4','5','6','7','8','9','10','A'].map(k=>[k,'D/H'])),
        '12':STANDARD_STRATEGY_H17.H['12'],
        '11':STANDARD_STRATEGY_H17.H['11'],
        '10':STANDARD_STRATEGY_H17.H['10'],
        '9':STANDARD_STRATEGY_H17.H['9'],
        '8':STANDARD_STRATEGY_H17.H['8'],
      }
    };
    SPANISH_21_STRATEGY.H['16']['9']='R/H';
    SPANISH_21_STRATEGY.H['16']['10']='R/H';
    SPANISH_21_STRATEGY.H['16']['A']='R/H';

    // ===== Game Configs =====
    const GAME_CONFIGS={
      'SingleDeckH17':{name:'Single-Deck (Dealer H17)',decks:1,dealerHitsSoft17:true,pushOnDealer22:false,hasSurrender:false,noTens:false,bjPayout:'3:2',strategy:STANDARD_STRATEGY_H17,doubleLabel:'Double',splitLabel:'Split'},
      'DoubleDeckS17':{name:'Double-Deck (Dealer S17)',decks:2,dealerHitsSoft17:false,pushOnDealer22:false,hasSurrender:false,noTens:false,bjPayout:'3:2',strategy:STANDARD_STRATEGY_S17,doubleLabel:'Double',splitLabel:'Split'},
      '6DeckS17':{name:'Classic 6-Deck (Dealer S17)',decks:6,dealerHitsSoft17:false,pushOnDealer22:false,hasSurrender:false,noTens:false,bjPayout:'3:2',strategy:STANDARD_STRATEGY_S17,doubleLabel:'Double',splitLabel:'Split'},
      'VegasStrip':{name:'Vegas Strip (4D S17)',decks:4,dealerHitsSoft17:false,pushOnDealer22:false,hasSurrender:false,noTens:false,bjPayout:'3:2',strategy:STANDARD_STRATEGY_S17,doubleLabel:'Double',splitLabel:'Split'},
      'AtlanticCity':{name:'Atlantic City (8D S17)',decks:8,dealerHitsSoft17:false,pushOnDealer22:false,hasSurrender:true,noTens:false,bjPayout:'3:2',strategy:AC_STRATEGY,doubleLabel:'Double',splitLabel:'Split'},
      'FreeBet':{name:'Free Bet Blackjack (22 Push)',decks:6,dealerHitsSoft17:false,pushOnDealer22:true,hasSurrender:false,noTens:false,bjPayout:'3:2',strategy:FREE_BET_STRATEGY,doubleLabel:'<span class="free-bet-text">Free Double</span>',splitLabel:'<span class="free-bet-text">Free Split</span>'},
      'Switch':{name:'Blackjack Switch (22 Push, BJ 1:1)',decks:6,dealerHitsSoft17:true,pushOnDealer22:true,hasSurrender:false,noTens:false,bjPayout:'1:1',strategy:STANDARD_STRATEGY_H17,doubleLabel:'Double',splitLabel:'Split'},
      'Spanish21':{name:'Spanish 21 (No 10s)',decks:6,dealerHitsSoft17:true,pushOnDealer22:false,hasSurrender:true,noTens:false,bjPayout:'Player 21 Wins',strategy:SPANISH_21_STRATEGY,doubleLabel:'Double',splitLabel:'Split'}
    };

    // ===== Free/Demo Gate =====
    const FREE_HAND_LIMIT=3;
    const LS_KEY_HANDS_USED='bj_demo_hands_used';

    const PRESETS=[
      { // #1 Soft 18 vs 9
        player:[{rank:'A',suit:'♥'},{rank:'7',suit:'♣'}],
        dealer:[{rank:'5',suit:'♦'},{rank:'9',suit:'♠'}]
      },
      { // #2 Pair 8s vs 10
        player:[{rank:'8',suit:'♦'},{rank:'8',suit:'♣'}],
        dealer:[{rank:'3',suit:'♣'},{rank:'10',suit:'♦'}]
      },
      { // #3 Hard 11 vs 6
        player:[{rank:'5',suit:'♠'},{rank:'6',suit:'♠'}],
        dealer:[{rank:'2',suit:'♥'},{rank:'6',suit:'♥'}]
      },
    ];

    // ===== Game State =====
    let deck=[];
    let playerHand=[];
    let dealerHand=[];
    let initialPlayerHand=[];
    let initialDealerHand=[];
    let gameActive=false;
    let isFirstMove=false;
    let currentConfig;
    let stats={ totalHands:0, correctMoves:0 };

    // ===== DOM =====
    const $versionSelect=document.getElementById('game-version');
    const $playerHand=document.getElementById('player-hand');
    const $dealerHand=document.getElementById('dealer-hand');
    const $playerValue=document.getElementById('player-value');
    const $dealerValue=document.getElementById('dealer-value');
    const $feedback=document.getElementById('feedback');
    const $hitBtn=document.getElementById('hit-btn');
    const $standBtn=document.getElementById('stand-btn');
    const $doubleBtn=document.getElementById('double-btn');
    const $splitBtn=document.getElementById('split-btn');
    const $surrenderBtn=document.getElementById('surrender-btn');
    const $newHandBtn=document.getElementById('new-hand-btn');
    const $repeatHandBtn=document.getElementById('repeat-hand-btn');
    const $restartStatsBtn=document.getElementById('restart-stats-btn');
    const $freeLeft=document.getElementById('free-left');
    const $restoreBtn=document.getElementById('restore-btn');

    const $upgradeModal=document.getElementById('upgrade-modal');
    const $upgradeOverlay=document.getElementById('upgrade-overlay');
    const $modalClose=document.getElementById('modal-close');
    const $modalUpgrade=document.getElementById('modal-upgrade');

    // ===== Helpers =====
    function getHandsUsed(){
      const v=parseInt(localStorage.getItem(LS_KEY_HANDS_USED)||'0',10);
      return isNaN(v)?0:v;
    }
    function setHandsUsed(v){
      localStorage.setItem(LS_KEY_HANDS_USED,String(v));
      updateFreeLeft();
    }
    function updateFreeLeft(){
      const used=getHandsUsed();
      const left=Math.max(0, FREE_HAND_LIMIT-used);
      $freeLeft.textContent=left;
    }
    function isDemoLocked(){
      return getHandsUsed()>=FREE_HAND_LIMIT;
    }
    function openUpgrade(){
      $upgradeOverlay.classList.remove('hidden');
      $upgradeModal.classList.remove('hidden');
      toggleControls(false);
    }
    function closeUpgrade(){
      $upgradeOverlay.classList.add('hidden');
      $upgradeModal.classList.add('hidden');
    }

    // ===== Deck / Cards =====
    function createAndShuffleDeck(){
      let newDeck=[];
      const numDecks=currentConfig.decks;
      for(let d=0; d<numDecks; d++){
        for(const rank of RANKS){
          if(currentConfig.noTens && rank==='10') continue;
          for(const suit of SUITS){ newDeck.push({rank,suit}); }
        }
      }
      for(let i=newDeck.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [newDeck[i],newDeck[j]]=[newDeck[j],newDeck[i]];
      }
      return newDeck;
    }

    function calculateHandValue(hand){
      let value=0;let aceCount=0;
      for(const card of hand){
        value+=VALUES[card.rank];
        if(card.rank==='A') aceCount++;
      }
      let isSoft = aceCount>0 && value<=21;
      while(value>21 && aceCount>0){
        value-=10; aceCount--; isSoft = aceCount>0 && value<=21;
      }
      return {value,isSoft};
    }

    function renderCard(card,isHidden=false){
      const suitClass=(card.suit==='♥'||card.suit==='♦')?'red-suit':'black-suit';
      const cardRank=card.rank==='10'?'T':card.rank;
      if(isHidden) return `<div class="card-container hole-card">?</div>`;
      const rotation=Math.floor(Math.random()*6)-3;
      return `
        <div class="card-container" style="--rotation:${rotation}deg;">
          <span class="${suitClass} text-[0.65rem] self-start">${cardRank}</span>
          <span class="${suitClass} text-2xl">${card.suit}</span>
          <span class="${suitClass} text-[0.65rem] self-end">${cardRank}</span>
        </div>
      `;
    }

    function updateDisplay(showDealerHole=false){
      $playerHand.innerHTML=playerHand.map(c=>renderCard(c)).join('');
      $playerValue.textContent=calculateHandValue(playerHand).value;

      const dealerCards=dealerHand.map((c,i)=>{
        if(i===0 && !showDealerHole) return renderCard(c,true);
        return renderCard(c);
      });
      $dealerHand.innerHTML=dealerCards.join('');
      $dealerValue.textContent=showDealerHole
        ? calculateHandValue(dealerHand).value
        : (dealerHand.length>1 ? VALUES[dealerHand[1].rank] : '?');
    }

    function toggleControls(enable){
      $hitBtn.disabled=!enable;
      $standBtn.disabled=!enable;

      const canSplit = playerHand.length===2 && playerHand[0].rank===playerHand[1].rank;
      $doubleBtn.innerHTML=currentConfig.doubleLabel;
      $splitBtn.innerHTML=currentConfig.splitLabel;

      $doubleBtn.disabled=!enable || !isFirstMove;
      $splitBtn.disabled=!enable || !isFirstMove || !canSplit;

      $surrenderBtn.disabled=!enable || !isFirstMove;
      if(currentConfig.hasSurrender){ $surrenderBtn.classList.remove('hidden'); }
      else { $surrenderBtn.classList.add('hidden'); }
    }

    function updateStats(){
      document.getElementById('stats-total').textContent=stats.totalHands;
      document.getElementById('stats-correct').textContent=stats.correctMoves;
      const accEl=document.getElementById('stats-accuracy');
      if(stats.totalHands>0){
        const acc=((stats.correctMoves/stats.totalHands)*100).toFixed(1);
        accEl.textContent=`${acc}%`;
        accEl.classList.remove('text-red-400','text-yellow-400','text-green-400','text-amber-300');
        if(acc<70) accEl.classList.add('text-red-400');
        else if(acc<90) accEl.classList.add('text-yellow-400');
        else accEl.classList.add('text-green-400');
      } else {
        accEl.textContent='0%';
        accEl.classList.remove('text-red-400','text-yellow-400','text-green-400');
        accEl.classList.add('text-amber-300');
      }
      localStorage.setItem('gtoSharkBJStats',JSON.stringify(stats));
    }

    // ===== Strategy =====
    function getOptimalMove(){
      const strategyTable=currentConfig.strategy;
      const dealerUpCardRank=dealerHand[1].rank;
      const upCardKey=dealerUpCardRank==='A' ? 'A' : (VALUES[dealerUpCardRank]===10 ? '10' : dealerUpCardRank);
      const {value:pv,isSoft}=calculateHandValue(playerHand);

      if(playerHand.length===2 && playerHand[0].rank===playerHand[1].rank){
        const r=playerHand[0].rank;
        const pairKey=(r==='10'||r==='J'||r==='Q'||r==='K')?'1010':(r+r);
        return strategyTable['P'][pairKey]?.[upCardKey] || 'H';
      }
      if(isSoft && pv>=13 && pv<=20){
        return strategyTable['S'][String(pv)]?.[upCardKey] || 'S';
      }
      if(pv>=8 && pv<=17){
        return strategyTable['H'][String(pv)]?.[upCardKey] || 'H';
      }
      if(pv>17) return 'S';
      return 'H';
    }

    function checkStrategy(playerMove){
      if(!gameActive) return;
      stats.totalHands++;
      const optimal=getOptimalMove();
      let optimalText=optimal;
      let correct=false;

      if(optimal.includes('/')){
        const [primary,secondary]=optimal.split('/');
        let primaryPossible=false;
        if(primary==='D' || primary==='FD'){ primaryPossible=isFirstMove; }
        else if(primary==='P' || primary==='FP'){ primaryPossible=isFirstMove && playerHand.length===2 && playerHand[0].rank===playerHand[1].rank; }
        else if(primary==='R'){ primaryPossible=isFirstMove && currentConfig.hasSurrender; }

        if(primaryPossible){
          optimalText=primary;
          if( (playerMove==='Double' && primary.includes('D')) ||
              (playerMove==='Split' && primary.includes('P')) ||
              (playerMove==='Surrender' && primary.includes('R')) ||
              playerMove[0]===primary[0]) correct=true;
        } else {
          optimalText=secondary;
          if(playerMove[0]===secondary[0]) correct=true;
        }
      } else {
        if(playerMove[0]===optimal[0]) correct=true;
      }

      let display=optimalText.replace('D','Double').replace('P','Split').replace('R','Surrender').replace('F','Free ');
      display=display.replace(/<\/?span[^>]*>/g,'');

      if(correct){
        stats.correctMoves++;
        $feedback.textContent=`Correct. ${playerMove} was optimal (${display}).`;
        $feedback.className='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-emerald-700/70 border border-emerald-400/60';
      } else {
        $feedback.textContent=`Error. Optimal move: ${display.toUpperCase()}. You chose ${playerMove}.`;
        $feedback.className='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-rose-700/80 border border-rose-400/70';
      }
      updateStats();
    }

    // ===== Game Flow =====
    function dealCard(hand){
      if(deck.length===0){ deck=createAndShuffleDeck(); }
      hand.push(deck.pop());
    }

    function dealInitialCards(useInitial){
      playerHand=[]; dealerHand=[];
      if(useInitial && initialPlayerHand.length===2 && initialDealerHand.length===2){
        playerHand=[...initialPlayerHand];
        dealerHand=[...initialDealerHand];
        return;
      }
      dealCard(playerHand);
      dealCard(dealerHand);
      dealCard(playerHand);
      dealCard(dealerHand);

      initialPlayerHand=[...playerHand];
      initialDealerHand=[...dealerHand];
    }

    function checkInitialBlackjack(){
      const pv=calculateHandValue(playerHand).value;
      const dv=calculateHandValue(dealerHand).value;
      if(pv===21){
        if(dv===21) endHand('Dealer and Player both have Blackjack (Push).');
        else endHand(`Player has Blackjack. Payout: ${currentConfig.bjPayout}.`);
      } else if(dv===21){
        endHand('Dealer has Blackjack. Dealer wins.');
      }
    }

    function dealerPlay(){
      let {value:dv,isSoft}=calculateHandValue(dealerHand);
      while(dv<17 || (currentConfig.dealerHitsSoft17 && dv===17 && isSoft)){
        dealCard(dealerHand);
        updateDisplay(true);
        ({value:dv,isSoft}=calculateHandValue(dealerHand));
        if(currentConfig.pushOnDealer22 && dv===22) return;
      }
    }

    function endHand(message){
      gameActive=false;
      updateDisplay(true);
      toggleControls(false);
      $repeatHandBtn.disabled=false;

      if(!message.includes('Blackjack') && !message.includes('Busts') && !message.includes('Surrender') && !message.includes('Doubles') && !message.includes('Split')){
        dealerPlay();
        const pv=calculateHandValue(playerHand).value;
        const dv=calculateHandValue(dealerHand).value;
        if(pv>21) message='Player busts. Dealer wins.';
        else if(currentConfig.noTens && pv===21) message='Player 21 wins (Spanish 21 rule).';
        else if(currentConfig.pushOnDealer22 && dv===22) message='Dealer has 22. Push (Free Bet / Switch rule).';
        else if(dv>21) message='Dealer busts. Player wins.';
        else if(pv>dv) message='Player wins.';
        else if(pv<dv) message='Dealer wins.';
        else message='Push (tie).';
      }

      let cls='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-slate-900/80 border border-slate-700/70';
      if(message.includes('Player wins') || (message.includes('wins.') && !message.includes('Dealer wins'))) {
        cls='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-emerald-700/80 border border-emerald-400/70';
      } else if(message.includes('Dealer wins') || message.includes('busts') || message.includes('Surrender')) {
        cls='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-rose-700/80 border border-rose-400/70';
      }

      $feedback.textContent=message;
      $feedback.className=cls;
    }

    function usePresetIfAvailable(){
      const used=getHandsUsed();
      if(used<FREE_HAND_LIMIT){
        const preset=PRESETS[used];
        playerHand=[...preset.player];
        dealerHand=[...preset.dealer];
        initialPlayerHand=[...playerHand];
        initialDealerHand=[...dealerHand];
        return true;
      }
      return false;
    }

    // ===== Initialize / Start / Repeat =====
    function initializeGame(){
      currentConfig=GAME_CONFIGS[$versionSelect.value];
      const cardsPerDeck=currentConfig.noTens?48:52;
      const minDeckSize=currentConfig.decks*cardsPerDeck*0.25;

      if(deck.length<minDeckSize){
        deck=createAndShuffleDeck();
        $feedback.textContent=`Deck reshuffled for ${currentConfig.name}.`;
      } else {
        $feedback.textContent=`Ready for a new hand of ${currentConfig.name}. BJ payout: ${currentConfig.bjPayout}.`;
      }

      playerHand=[]; dealerHand=[];
      initialPlayerHand=[]; initialDealerHand=[];
      gameActive=false;
      $playerHand.innerHTML='';
      $dealerHand.innerHTML='';
      $playerValue.textContent='?';
      $dealerValue.textContent='?';

      $doubleBtn.innerHTML=currentConfig.doubleLabel;
      $splitBtn.innerHTML=currentConfig.splitLabel;

      toggleControls(false);
      $repeatHandBtn.disabled=true;
      $restoreBtn.disabled=true;
    }

    function startHand(){
      if(isDemoLocked()){
        openUpgrade();
        return;
      }
      gameActive=true;
      isFirstMove=true;
      $repeatHandBtn.disabled=true;
      $restoreBtn.disabled=true;

      const presetUsed=usePresetIfAvailable();
      if(!presetUsed){
        dealInitialCards(false);
      }

      updateDisplay();
      checkInitialBlackjack();
      toggleControls(gameActive);

      if(gameActive){
        $feedback.textContent='Make your first move: Hit, Stand, Double, Split, or Surrender.';
        $feedback.className='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-slate-900/70 border border-slate-700/70';
      }

      const used=getHandsUsed();
      if(used<FREE_HAND_LIMIT){
        setHandsUsed(used+1);
      }
    }

    function repeatHand(){
      if(gameActive || initialPlayerHand.length===0) return;
      gameActive=true;
      isFirstMove=true;
      $repeatHandBtn.disabled=true;
      $restoreBtn.disabled=true;

      playerHand=[...initialPlayerHand];
      dealerHand=[...initialDealerHand];

      updateDisplay();
      checkInitialBlackjack();
      toggleControls(gameActive);

      if(gameActive){
        $feedback.textContent='Repeating hand. Make your first move again.';
        $feedback.className='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-slate-900/70 border border-slate-700/70';
      }
    }

    function restartStats(){
      stats={ totalHands:0, correctMoves:0 };
      localStorage.removeItem('gtoSharkBJStats');
      localStorage.removeItem(LS_KEY_HANDS_USED);

      updateStats();
      updateFreeLeft();
      $feedback.textContent='Strategy statistics reset. Free demo hands reset.';
      $feedback.className='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-rose-700/80 border border-rose-400/80';

      initializeGame();
    }

    // ===== Player Actions =====
    function handleHit(){
      if(!gameActive) return;
      checkStrategy('Hit');
      dealCard(playerHand);
      updateDisplay();
      isFirstMove=false;
      toggleControls(gameActive);

      const pv=calculateHandValue(playerHand).value;
      if(pv>21) endHand('Player busts.');
      else if(pv===21) handleStand();
    }
    function handleStand(){
      if(!gameActive) return;
      checkStrategy('Stand');
      endHand('Player stands.');
    }
    function handleDouble(){
      if(!gameActive || !isFirstMove) return;
      checkStrategy('Double');
      dealCard(playerHand);
      updateDisplay();
      endHand(`${currentConfig.doubleLabel.includes('Free')?'Player free doubles down':'Player doubles down'}.`);
    }
    function handleSplit(){
      if(!gameActive || !isFirstMove || playerHand.length!==2 || playerHand[0].rank!==playerHand[1].rank){
        $feedback.textContent='Split not available. Only allowed on an initial pair.';
        $feedback.className='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-amber-700/80 border border-amber-400/80';
        return;
      }
      checkStrategy('Split');
      endHand(`${currentConfig.splitLabel.includes('Free')?'Free split taken':'Split taken'}. Tap New Hand to continue.`);
    }
    function handleSurrender(){
      if(!gameActive || !isFirstMove || !currentConfig.hasSurrender) return;
      checkStrategy('Surrender');
      endHand('Player chooses to surrender and loses half the bet.');
    }

    // ===== Events =====
    document.getElementById('game-version').addEventListener('change', ()=>{
      initializeGame();
    });

    $hitBtn.addEventListener('click',handleHit);
    $standBtn.addEventListener('click',handleStand);
    $doubleBtn.addEventListener('click',handleDouble);
    $splitBtn.addEventListener('click',handleSplit);
    $surrenderBtn.addEventListener('click',handleSurrender);
    $newHandBtn.addEventListener('click',startHand);
    $repeatHandBtn.addEventListener('click',repeatHand);
    $restartStatsBtn.addEventListener('click',restartStats);

    $modalClose.addEventListener('click',()=>{
      closeUpgrade();
      $feedback.textContent='Upgrade to unlock unlimited hands.';
      $feedback.className='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-slate-900/70 border border-slate-700/70';
    });
    $modalUpgrade.addEventListener('click',()=>{
      closeUpgrade();
      $feedback.textContent='Redirecting to checkout...';
      $feedback.className='panel-soft text-center text-sm sm:text-base font-semibold px-4 py-3 mb-5 bg-emerald-700/80 border border-emerald-400/80';
      // window.location.href = '/upgrade';
    });

    window.onload=()=>{
      try{
        const stored=JSON.parse(localStorage.getItem('gtoSharkBJStats'));
        if(stored){ stats=stored; }
      }catch(e){}
      updateStats();
      updateFreeLeft();
      initializeGame();
    };
  </script>
</body>
</html>





